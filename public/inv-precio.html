<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Inventario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ“± Analizador de Inventario</h1>
            <p class="text-gray-600">Herramientas completas para analizar tu inventario de dispositivos</p>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-8">
            <div class="flex border-b border-gray-200">
                <button id="devicesTab" class="flex-1 py-4 px-6 text-center font-medium text-blue-600 border-b-2 border-blue-600 bg-blue-50">
                    ğŸ“± Contador de Dispositivos
                </button>
                <button id="productsTab" class="flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700">
                    ğŸ’° Analizador de Precios
                </button>
            </div>
        </div>

        <!-- Devices Counter Tab -->
        <div id="devicesContent" class="tab-content">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        ğŸ“ Texto de Entrada
                    </h2>
                    <textarea 
                        id="devicesInputText" 
                        placeholder="Pega aquÃ­ tu inventario de dispositivos..."
                        class="w-full h-96 p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none resize-none font-mono text-sm"
                    ></textarea>
                    <div class="flex gap-3 mt-4">
                        <button 
                            id="devicesAnalyzeBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center gap-2"
                        >
                            ğŸ” Analizar
                        </button>
                        <button 
                            id="devicesClearBtn"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                        >
                            ğŸ—‘ï¸ Limpiar
                        </button>
                        <button 
                            id="devicesSampleBtn"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                        >
                            ğŸ“‹ Ejemplo
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        ğŸ“Š Resultados
                    </h2>
                    
                    <!-- Total Counter -->
                    <div id="devicesTotalSection" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-6 text-center hidden">
                        <h3 class="text-lg font-medium mb-2">Total de Dispositivos</h3>
                        <div id="devicesTotalCount" class="text-5xl font-bold">0</div>
                    </div>

                    <!-- Statistics -->
                    <div id="devicesStatsSection" class="grid grid-cols-2 gap-4 mb-6 hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600" id="devicesLinesProcessed">0</div>
                            <div class="text-sm text-green-700">LÃ­neas Procesadas</div>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600" id="devicesParenLines">0</div>
                            <div class="text-sm text-purple-700">Con ParÃ©ntesis</div>
                        </div>
                    </div>

                    <!-- Breakdown -->
                    <div id="devicesBreakdownSection" class="hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ“‹ Desglose Detallado</h3>
                        <div id="devicesBreakdown" class="space-y-2 max-h-80 overflow-y-auto"></div>
                    </div>

                    <!-- Empty State -->
                    <div id="devicesEmptyState" class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ“±</div>
                        <p class="text-gray-500 text-lg">Pega tu inventario y presiona "Analizar" para ver los resultados</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Analyzer Tab -->
        <div id="productsContent" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        ğŸ“ Lista de Productos
                    </h2>
                    <textarea 
                        id="productsInputText" 
                        placeholder="Pega aquÃ­ tu lista de productos con precios..."
                        class="w-full h-96 p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none resize-none font-mono text-sm"
                    ></textarea>
                    <div class="flex gap-3 mt-4">
                        <button 
                            id="productsAnalyzeBtn"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center gap-2"
                        >
                            ğŸ’° Analizar Precios
                        </button>
                        <button 
                            id="productsClearBtn"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                        >
                            ğŸ—‘ï¸ Limpiar
                        </button>
                        <button 
                            id="productsSampleBtn"
                            class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                        >
                            ğŸ“‹ Ejemplo
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        ğŸ“Š AnÃ¡lisis de Precios
                    </h2>
                    
                    <!-- JavaScript Code Output -->
                    <div id="productsCodeSection" class="hidden">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg font-semibold text-gray-800">ğŸ“‹ CÃ³digo JavaScript</h3>
                            <button id="copyCodeBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                ğŸ“‹ Copiar CÃ³digo
                            </button>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-4 max-h-96 overflow-y-auto">
                            <pre id="jsCodeOutput" class="text-green-400 text-sm font-mono whitespace-pre-wrap"></pre>
                        </div>
                        <div id="copySuccess" class="mt-2 text-green-600 text-sm hidden">âœ… CÃ³digo copiado al portapapeles</div>
                    </div>

                    <!-- Empty State -->
                    <div id="productsEmptyState" class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ’°</div>
                        <p class="text-gray-500 text-lg">Pega tu lista de productos y presiona "Analizar Precios"</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">â„¹ï¸ CÃ³mo Funciona</h3>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">ğŸ“± Contador de Dispositivos</h4>
                    <ul class="text-gray-600 text-sm space-y-1">
                        <li>â€¢ Cuenta nÃºmeros en parÃ©ntesis (5) directamente</li>
                        <li>â€¢ Busca capacidades (64gb, 128gb) y cuenta nÃºmeros 0-100 despuÃ©s</li>
                        <li>â€¢ Ignora lÃ­neas vacÃ­as y separadores</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">ğŸ’° Analizador de Precios</h4>
                    <ul class="text-gray-600 text-sm space-y-1">
                        <li>â€¢ Detecta precios con formato 1.234$ o 1,234.56$</li>
                        <li>â€¢ Extrae nombres de productos limpiando emojis</li>
                        <li>â€¢ Calcula estadÃ­sticas de precios automÃ¡ticamente</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // FunciÃ³n original para contar dispositivos
        function countDevicesBetter(text) {
            const lines = text.split(/\r?\n/);
            let total = 0;
            const breakdown = [];

            for (let i = 0; i < lines.length; i++) {
                const raw = lines[i];
                const line = raw.trim();
                if (!line || /^[/\s]+$/.test(line)) continue;

                let lineCount = 0;
                const parenMatches = [...line.matchAll(/\((\d+)\)/g)];
                for (const m of parenMatches) {
                    lineCount += parseInt(m[1], 10);
                }
                if (parenMatches.length) {
                    total += lineCount;
                    breakdown.push({ line: raw, added: lineCount, reason: 'parens' });
                    continue;
                }

                const capMatches = [...line.matchAll(/(?<!\d)(\d+)\s*(gb|tb|gn|gv)\b/gi)];
                if (!capMatches.length) continue;

                const last = capMatches[capMatches.length - 1];
                const tail = line.slice(last.index + last[0].length);

                const nums = [...tail.matchAll(/(\d{1,3})(?=\D|$)/g)].map(m => parseInt(m[1], 10));
                let added = 0;
                for (const n of nums) if (n >= 0 && n <= 100) added++;
                total += added;
                breakdown.push({ line: raw, added, nums });
            }

            return { total, breakdown };
        }

        // FunciÃ³n original para parsear productos
        function parseProductosCompleto(texto) {
            const productos = [];
            const lineas = texto.split(/\r?\n/).filter(l => l.trim() && !l.toLowerCase().includes("actualizaciÃ³n de precios"));
            const regexPrecio = /(\d{1,3}(?:[.,]\d{3})*(?:[.,]\d+)?)(?:\s*\$)/;

            for (const linea of lineas) {
                const precioMatch = linea.match(regexPrecio);

                if (precioMatch) {
                    let precioStr = precioMatch[1].replace(/\./g, '').replace(',', '.');
                    let precio = parseFloat(precioStr);

                    let nombre = linea
                        .replace(regexPrecio, '')
                        .replace(/(\$|PROMO|clase\s?[a-zA-Z]+|baterÃ­as\s?bajas|\s*\d{1,3}\s?\$\s*)/gi, '')
                        .replace(/[\u{1F300}-\u{1F6FF}]/gu, '')
                        .trim();

                    productos.push({ nombre, precio });
                }
            }
            return { productos };
        }

        // Textos de ejemplo
        const devicesSampleText = `EstaciÃ³n central
â€¢Airpods pro 3âœ…
Xr128gb black 81 TIENDA
////////////////////////////////////
1164gb black 100/100/100âœ…
11256gn red 100âœ…
/////////////////////////////
11pm 64gb Space 100pcmanchağŸ›…âœ…
///////////////////////////////////
12 64gb lila 82âœ…
12 64gb coral 84âœ…
1264gb blue 100/84/84âœ…
12 64gb black 100pcâœ…
12 128gb lila 82/81âœ…
12 128gb mint 86âœ…
12 128gb blue 83/85âœ…
12 128gb blue 100WeppaâŒ
12 256gb black 84/100âœ…`;

        const productsSampleText = `iPhone 13 Pro 128GB 1.200$
Samsung Galaxy S23 Ultra 256GB 1.500$
MacBook Air M2 2.300$
iPad Pro 11" 128GB 950$
AirPods Pro 2da Gen 280$
Apple Watch Series 8 450$
iPhone 14 Plus 256GB 1.100$
Samsung Galaxy Tab S8 800$`;

        // Referencias DOM
        const devicesTab = document.getElementById('devicesTab');
        const productsTab = document.getElementById('productsTab');
        const devicesContent = document.getElementById('devicesContent');
        const productsContent = document.getElementById('productsContent');

        // Elementos del contador de dispositivos
        const devicesInputText = document.getElementById('devicesInputText');
        const devicesAnalyzeBtn = document.getElementById('devicesAnalyzeBtn');
        const devicesClearBtn = document.getElementById('devicesClearBtn');
        const devicesSampleBtn = document.getElementById('devicesSampleBtn');
        const devicesTotalSection = document.getElementById('devicesTotalSection');
        const devicesTotalCount = document.getElementById('devicesTotalCount');
        const devicesStatsSection = document.getElementById('devicesStatsSection');
        const devicesLinesProcessed = document.getElementById('devicesLinesProcessed');
        const devicesParenLines = document.getElementById('devicesParenLines');
        const devicesBreakdownSection = document.getElementById('devicesBreakdownSection');
        const devicesBreakdown = document.getElementById('devicesBreakdown');
        const devicesEmptyState = document.getElementById('devicesEmptyState');

        // Elementos del analizador de productos
        const productsInputText = document.getElementById('productsInputText');
        const productsAnalyzeBtn = document.getElementById('productsAnalyzeBtn');
        const productsClearBtn = document.getElementById('productsClearBtn');
        const productsSampleBtn = document.getElementById('productsSampleBtn');
        const productsCodeSection = document.getElementById('productsCodeSection');
        const jsCodeOutput = document.getElementById('jsCodeOutput');
        const copyCodeBtn = document.getElementById('copyCodeBtn');
        const copySuccess = document.getElementById('copySuccess');
        const productsEmptyState = document.getElementById('productsEmptyState');

        // Funciones para cambiar pestaÃ±as
        function showDevicesTab() {
            devicesTab.className = 'flex-1 py-4 px-6 text-center font-medium text-blue-600 border-b-2 border-blue-600 bg-blue-50';
            productsTab.className = 'flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700';
            devicesContent.classList.remove('hidden');
            productsContent.classList.add('hidden');
        }

        function showProductsTab() {
            productsTab.className = 'flex-1 py-4 px-6 text-center font-medium text-green-600 border-b-2 border-green-600 bg-green-50';
            devicesTab.className = 'flex-1 py-4 px-6 text-center font-medium text-gray-500 hover:text-gray-700';
            productsContent.classList.remove('hidden');
            devicesContent.classList.add('hidden');
        }

        // Funciones para mostrar resultados de dispositivos
        function displayDevicesResults(results) {
            devicesEmptyState.classList.add('hidden');
            
            devicesTotalSection.classList.remove('hidden');
            devicesTotalCount.textContent = results.total;
            
            const processedLines = results.breakdown.length;
            const parenLinesCount = results.breakdown.filter(item => item.reason === 'parens').length;
            
            devicesStatsSection.classList.remove('hidden');
            devicesLinesProcessed.textContent = processedLines;
            devicesParenLines.textContent = parenLinesCount;
            
            devicesBreakdownSection.classList.remove('hidden');
            devicesBreakdown.innerHTML = '';
            
            results.breakdown.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'bg-gray-50 border border-gray-200 rounded-lg p-3';
                
                const reasonText = item.reason === 'parens' ? 
                    `ğŸ“Š ParÃ©ntesis: +${item.added}` : 
                    `ğŸ”¢ NÃºmeros (0-100): +${item.added}`;
                
                div.innerHTML = `
                    <div class="flex justify-between items-start gap-3">
                        <div class="flex-1 min-w-0">
                            <div class="font-mono text-sm text-gray-700 truncate" title="${item.line}">
                                ${item.line}
                            </div>
                        </div>
                        <div class="flex-shrink-0">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                item.added > 0 ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'
                            }">
                                ${reasonText}
                            </span>
                        </div>
                    </div>
                `;
                
                devicesBreakdown.appendChild(div);
            });
        }

        function hideDevicesResults() {
            devicesTotalSection.classList.add('hidden');
            devicesStatsSection.classList.add('hidden');
            devicesBreakdownSection.classList.add('hidden');
            devicesEmptyState.classList.remove('hidden');
        }

        // Funciones para mostrar resultados de productos
        function displayProductsResults(results) {
            productsEmptyState.classList.add('hidden');
            
            // Generar cÃ³digo JavaScript
            const jsCode = `const productos = ${JSON.stringify(results.productos, null, 2)};`;
            
            // Mostrar cÃ³digo
            productsCodeSection.classList.remove('hidden');
            jsCodeOutput.textContent = jsCode;
        }

        function hideProductsResults() {
            productsCodeSection.classList.add('hidden');
            productsEmptyState.classList.remove('hidden');
        }

        // FunciÃ³n para copiar cÃ³digo al portapapeles
        function copyToClipboard() {
            const code = jsCodeOutput.textContent;
            navigator.clipboard.writeText(code).then(() => {
                copySuccess.classList.remove('hidden');
                setTimeout(() => {
                    copySuccess.classList.add('hidden');
                }, 2000);
            }).catch(err => {
                // Fallback para navegadores que no soportan clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                copySuccess.classList.remove('hidden');
                setTimeout(() => {
                    copySuccess.classList.add('hidden');
                }, 2000);
            });
        }

        // Event listeners para pestaÃ±as
        devicesTab.addEventListener('click', showDevicesTab);
        productsTab.addEventListener('click', showProductsTab);

        // Event listeners para dispositivos
        devicesAnalyzeBtn.addEventListener('click', () => {
            const text = devicesInputText.value.trim();
            if (!text) {
                alert('Por favor, ingresa algÃºn texto para analizar');
                return;
            }
            
            const results = countDevicesBetter(text);
            displayDevicesResults(results);
        });

        devicesClearBtn.addEventListener('click', () => {
            devicesInputText.value = '';
            hideDevicesResults();
        });

        devicesSampleBtn.addEventListener('click', () => {
            devicesInputText.value = devicesSampleText;
        });

        // Event listeners para productos
        productsAnalyzeBtn.addEventListener('click', () => {
            const text = productsInputText.value.trim();
            if (!text) {
                alert('Por favor, ingresa algÃºn texto para analizar');
                return;
            }
            
            const results = parseProductosCompleto(text);
            displayProductsResults(results);
        });

        productsClearBtn.addEventListener('click', () => {
            productsInputText.value = '';
            hideProductsResults();
        });

        productsSampleBtn.addEventListener('click', () => {
            productsInputText.value = productsSampleText;
        });

        copyCodeBtn.addEventListener('click', copyToClipboard);

        // Auto-analizar al pegar texto
        devicesInputText.addEventListener('paste', () => {
            setTimeout(() => {
                if (devicesInputText.value.trim()) {
                    const results = countDevicesBetter(devicesInputText.value);
                    displayDevicesResults(results);
                }
            }, 100);
        });

        productsInputText.addEventListener('paste', () => {
            setTimeout(() => {
                if (productsInputText.value.trim()) {
                    const results = parseProductosCompleto(productsInputText.value);
                    displayProductsResults(results);
                }
            }, 100);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ae90d9a39fc880',t:'MTc1OTg1MjM0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
