/* const productos = [
  { nombre: "Apple Watch Serie 8 45mm", usd: 280 },
  { nombre: "Apple Watch Serie 9 45mm", usd: 299 },
  { nombre: "Apple Watch Serie X 42mm", usd: 440 },
  { nombre: "Apple Watch Serie X 46mm", usd: 480 },
  { nombre: "Apple Watch Ultra 3", usd: 1040 },
  { nombre: "AirPods 4", usd: 250 },
  { nombre: "AirPods Pro 3", usd: 420 },
  { nombre: "Apple Watch Series 11", usd: 590 },
  { nombre: "iPhone 11 (64gb)", usd: 249 },
  { nombre: "iPhone 11 (128gb)", usd: 279 },
  { nombre: "iPhone 11 (256gb)", usd: 299 },
  { nombre: "iPhone 11 Pro (64gb)", usd: 290 },
  { nombre: "iPhone 11 Pro (256gb)", usd: 349 },
  { nombre: "iPhone 11 Pro Max (64gb)", usd: 340 },
  { nombre: "iPhone 11 Pro Max (256gb)", usd: 350 },
  { nombre: "iPhone 12 (64gb)", usd: 285 },
  { nombre: "iPhone 12 (128gb)", usd: 310 },
  { nombre: "iPhone 12 (256gb)", usd: 340 },
  { nombre: "iPhone 12 Pro (128gb)", usd: 359 },
  { nombre: "iPhone 12 Pro (256gb)", usd: 390 },
  { nombre: "iPhone 12 Pro (512gb)", usd: 410 },
  { nombre: "iPhone 12 Pro Max (128gb)", usd: 439 },
  { nombre: "iPhone 12 Pro Max (256gb)", usd: 470 },
  { nombre: "iPhone 12 Pro Max (512gb)", usd: 520 },
  { nombre: "iPhone 13 (128gb)", usd: 390 }, // clase A
  { nombre: "iPhone 13 (256gb)", usd: 419 },
  { nombre: "iPhone 13 (512gb)", usd: 429 },
  { nombre: "iPhone 13 Pro (128gb)", usd: 489 },
  { nombre: "iPhone 13 Pro (256gb)", usd: 529 },
  { nombre: "iPhone 13 Pro (512gb)", usd: 559 },
  { nombre: "iPhone 13 Pro (1TB)", usd: 580 },
  { nombre: "iPhone 13 Pro Max (128gb)", usd: 560 },
  { nombre: "iPhone 13 Pro Max (256gb)", usd: 590 },
  { nombre: "iPhone 13 Pro Max (512gb)", usd: 649 },
  { nombre: "iPhone 13 Pro Max (1TB)", usd: 669 },
  { nombre: "iPhone 14 (128gb)", usd: 429 },
  { nombre: "iPhone 14 (256gb)", usd: 459 },
  { nombre: "iPhone 14 (512gb)", usd: 489 },
  { nombre: "iPhone 14 Plus (128gb)", usd: 439 },
  { nombre: "iPhone 14 Plus (256gb)", usd: 479 },
  { nombre: "iPhone 14 Pro (128gb)", usd: 599 },
  { nombre: "iPhone 14 Pro (256gb)", usd: 629 },
  { nombre: "iPhone 14 Pro (512gb)", usd: 649 },
  { nombre: "iPhone 14 Pro Max (128gb)", usd: 699 },
  { nombre: "iPhone 14 Pro Max (256gb)", usd: 729 },
  { nombre: "iPhone 14 Pro Max (512gb)", usd: 779 },
  { nombre: "iPhone 15 (128gb)", usd: 610 },
  { nombre: "iPhone 15 (256gb)", usd: 650 },
  { nombre: "iPhone 15 (512gb)", usd: 689 },
  { nombre: "iPhone 15 Plus (128gb)", usd: 670 },
  { nombre: "iPhone 15 Plus (256gb)", usd: 699 },
  { nombre: "iPhone 15 Pro (128gb)", usd: 760 },
  { nombre: "iPhone 15 Pro (256gb)", usd: 799 },
  { nombre: "iPhone 15 Pro Max (256gb)", usd: 850 },
  { nombre: "iPhone 15 Pro Max (512gb)", usd: 920 },
  { nombre: "iPhone 15 Pro Max (1TB)", usd: 940 },
  { nombre: "iPhone 16 (128gb)", usd: 799 },
  { nombre: "iPhone 16 (256gb)", usd: 820 },
  { nombre: "iPhone 16 Plus (128gb)", usd: 840 },
  { nombre: "iPhone 16 Plus (256gb)", usd: 900 },
  { nombre: "iPhone 16 Pro (128gb)", usd: 970 },
  { nombre: "iPhone 16 Pro (512gb)", usd: 1120 },
  { nombre: "iPhone 16 Pro (1TB)", usd: 1160 },
  { nombre: "iPhone 16 Pro Max (256gb) 100%", usd: 1240 },
  { nombre: "iPhone 16 Pro Max (512gb) NO 100%", usd: 1240 },
  { nombre: "iPhone 16 Pro Max (1TB)", usd: 1350 },
  { nombre: "iPhone 17 (256gb)", usd: 1180 },
  { nombre: "iPhone 17 (512gb)", usd: 1330 },
  { nombre: "iPhone 17 Air", usd: 1330 },
  { nombre: "iPhone 17 Pro (1TB)", usd: 1890 },
  { nombre: "iPhone 17 Pro (256gb)", usd: 1560 },
  { nombre: "iPhone 17 Pro Max (256gb)", usd: 1690 },
  { nombre: "iPhone 17 Pro Max (512gb)", usd: 1980 },
  { nombre: "iPhone 17 Pro Max (1TB)", usd: 2199 },
  { nombre: "iPhone 17 Pro Max (2TB)", usd: 2699 }
]; */
const productos = [
  {
    "nombre": "Apple Watch serie 9 41 mm open box",
    "usd": 279
  },
  {
    "nombre": "Apple Watch serie X 42mm",
    "usd": 400
  },
  {
    "nombre": "Apple Watch serie X 46mm",
    "usd": 450
  },
  {
    "nombre": "Apple Watch Ultra 2",
    "usd": 550
  },
  {
    "nombre": "Apple Watch Ultra 3",
    "usd": 999
  },
  {
    "nombre": "AirPods 4",
    "usd": 250
  },
  {
    "nombre": "AirPods Pro 3",
    "usd": 399
  },
  {
    "nombre": "Apple Watch series 11",
    "usd": 590
  },
  {
    "nombre": "iPhone 11 (64)gb",
    "usd": 220
  },
  {
    "nombre": "IPhone 11(128)gb",
    "usd": 260
  },
  {
    "nombre": "IPhone 11(256)gb",
    "usd": 280
  },
  {
    "nombre": "IPhone 11 Pro (64gb)",
    "usd": 280
  },
  {
    "nombre": "IPhone 11 pro (256gb)",
    "usd": 310
  },
  {
    "nombre": "IPhone 11 Pro Max(64gb)",
    "usd": 299
  },
  {
    "nombre": "IPhone 11ProMax(256gb)",
    "usd": 330
  },
  {
    "nombre": "IPhone 12 (64gb)",
    "usd": 260
  },
  {
    "nombre": "IPhone 12 (128gb)",
    "usd": 289
  },
  {
    "nombre": "IPhone 12 (256gb)",
    "usd": 310
  },
  {
    "nombre": "Iphone 12 pro (128gb)",
    "usd": 340
  },
  {
    "nombre": "IPhone 12 pro (256gb)",
    "usd": 380
  },
  {
    "nombre": "IPhone 12 pro (512gb)",
    "usd": 410
  },
  {
    "nombre": "IPhone 12proMax128gb",
    "usd": 419
  },
  {
    "nombre": "IPhone 12proMax(256gb)",
    "usd": 449
  },
  {
    "nombre": "IPhone 12promax(512gb)",
    "usd": 499
  },
  {
    "nombre": "IPhone 13 ( 128gb)",
    "usd": 349
  },
  {
    "nombre": "IPhone 13 (128gb) 100%",
    "usd": 370
  },
  {
    "nombre": "IPhone 13 (256gb)",
    "usd": 399
  },
  {
    "nombre": "IPhone 13 (512gb)",
    "usd": 410
  },
  {
    "nombre": "IPhone 13 pro (128)gb",
    "usd": 459
  },
  {
    "nombre": "IPhone 13 pro (256)gb",
    "usd": 499
  },
  {
    "nombre": "IPhone 13 pro (512)gb",
    "usd": 520
  },
  {
    "nombre": "IPhone 13 pro (1TB)gb",
    "usd": 550
  },
  {
    "nombre": "IPhone 13 pro Max (128gb)",
    "usd": 549
  },
  {
    "nombre": "IPhone 13 pro Max (256gb)",
    "usd": 589
  },
  {
    "nombre": "IPhone 13 pro Max (512gb)",
    "usd": 639
  },
  {
    "nombre": "IPhone 13 pro Max (1TBgb)",
    "usd": 669
  },
  {
    "nombre": "IPhone 14 (128gb)",
    "usd": 399
  },
  {
    "nombre": "IPhone 14 (256gb)",
    "usd": 449
  },
  {
    "nombre": "IPhone 14 (512gb)",
    "usd": 479
  },
  {
    "nombre": "IPhone 14 plus(128gb)",
    "usd": 450
  },
  {
    "nombre": "IPhone 14 plus(256gb)",
    "usd": 489
  },
  {
    "nombre": "IPhone 14 pro(128gb)",
    "usd": 529
  },
  {
    "nombre": "IPhone 14 pro (256gb)",
    "usd": 589
  },
  {
    "nombre": "IPhone 14 pro (512gb)",
    "usd": 610
  },
  {
    "nombre": "IPhone 14 pro Max (128gb)",
    "usd": 649
  },
  {
    "nombre": "IPhone 14 pro Max (256gb)",
    "usd": 699
  },
  {
    "nombre": "IPhone 14 pro Max (512gb)",
    "usd": 779
  },
  {
    "nombre": "IPhone 15 (128gb)",
    "usd": 499
  },
  {
    "nombre": "IPhone 15 (256gb)",
    "usd": 559
  },
  {
    "nombre": "IPhone 15 (512gb)",
    "usd": 689
  },
  {
    "nombre": "Iphone 15 plus (128gb)",
    "usd": 670
  },
  {
    "nombre": "Iphone 15 plus (256gb)",
    "usd": 699
  },
  {
    "nombre": "IPhone 15 pro (128gb)",
    "usd": 719
  },
  {
    "nombre": "IPhone 15 pro (256gb)",
    "usd": 770
  },
  {
    "nombre": "IPhone 15 pro Max (256gb)",
    "usd": 809
  },
  {
    "nombre": "Iphone 15 pro Max (512gb)",
    "usd": 890
  },
  {
    "nombre": "Iphone 15 pro Max (1TB)",
    "usd": 940
  },
  {
    "nombre": "IPhone 16 (128gb)",
    "usd": 749
  },
  {
    "nombre": "IPhone 16 (256gb)",
    "usd": 820
  },
  {
    "nombre": "IPhone 16 PLUS (128gb)",
    "usd": 790
  },
  {
    "nombre": "IPhone 16 PLUS (256gb)",
    "usd": 840
  },
  {
    "nombre": "IPhone 16 pro (128gb)",
    "usd": 869
  },
  {
    "nombre": "IPhone 16 pro (256gb)",
    "usd": 919
  },
  {
    "nombre": "IPhone 16 pro (512)",
    "usd": 1000
  },
  {
    "nombre": "IPhone 16 pro (1TB)",
    "usd": 1050
  },
  {
    "nombre": "IPhone 16 pro Max (256gb)",
    "usd": 1050
  },
  {
    "nombre": "IPhone 16 pro Max (512gb)",
    "usd": 1120
  },
  {
    "nombre": "IPhone 16 pro Max (1TB)",
    "usd": 1170
  },
  {
    "nombre": "iphone 17 256",
    "usd": 1170
  },
  {
    "nombre": "Iphone 17 512",
    "usd": 1320
  },
  {
    "nombre": "Iphone 17 Air 256",
    "usd": 1220
  },
  {
    "nombre": "Iphone 17 Air 512",
    "usd": 1320
  },
  {
    "nombre": "Iphone 17 pro 256gb",
    "usd": 1419
  },
  {
    "nombre": "Iphone 17 pro Max 256gb",
    "usd": 1580
  },
  {
    "nombre": "Iphone 17 pro Max 512gb",
    "usd": 1850
  },
  {
    "nombre": "IPhone 17 pro Max 1TB",
    "usd": 2050
  },
  {
    "nombre": "IPhone 17 pro Max 2TB",
    "usd": 2599
  }
];
// Generar HTML <option> din√°micamente
const optionsHTML = productos.map(p => {
  const value = p.nombre
    .toLowerCase()
    .replace(/\\s+/g, "_")
    .replace(/[()%.]/g, "")
    .replace(/__+/g, "_");
  const emoji = p.nombre.toLowerCase().includes("watch") || p.nombre.toLowerCase().includes("airpods") ? "‚åö" : "üì±";
  return `<option value="${value}" data-price="${p.usd}" data-currency="USD">${emoji} ${p.nombre} - $${p.usd} USD</option>`;
}).join("\\n");

// Insertarlo en un <select> existente
const select = document.getElementById("productSelect");
//select.id = "productSelect";
select.className = "w-full p-3 border border-gray-300 rounded-lg input-focus transition-all";
select.innerHTML = `<option value="">Seleccionar producto...</option>\\n${optionsHTML}\\n<option value="custom">‚úèÔ∏è Producto personalizado</option>`;

//document.body.appendChild(select); // o puedes usar document.querySelector("#selectContainer").appendChild(select);



// scripts/main.js
let currentPrice = 0;
let currentCurrency = 'USD';
console.log("hh")
// Formateo num√©rico en espa√±ol
function formatNumber(number) {
  return number.toLocaleString('es-ES', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

// Elementos del DOM
const productSelect    = document.getElementById('productSelect');
const customPriceDiv   = document.getElementById('customPriceDiv');
const customPrice      = document.getElementById('customPrice');
const customCurrency   = document.getElementById('customCurrency');
const transferRate     = document.getElementById('transferRate');
const apiValueInput    = document.getElementById('apiValue');
const paymentMethod    = document.getElementById('paymentMethod');
const transferAmount   = document.getElementById('transferAmount');
const resultsDiv       = document.getElementById('results');
const comparisonDiv    = document.getElementById('comparison');
const comparisonContent= document.getElementById('comparisonContent');
const lastUpdateSpan   = document.getElementById('lastUpdate');

const batteryFullCheckbox = document.getElementById('batteryFullCheckbox');


// Funci√≥n reusable para obtener la tasa promedio de Binance P2P
/* async function fetchBinanceP2PAverage() {
  try {
    const res = await fetch('/.netlify/functions/binance-p2p-average?asset=USDT&fiat=VES&tradeType=SELL&rows=20&trim=0.1');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    const data = await res.json();
    if (!data.ok) throw new Error(data.message || 'Respuesta no v√°lida');

    // Tomamos el promedio recortado o el promedio simple
    const promedio = data.stats.trimmedAverage || data.stats.average;

    // Asignamos el valor al input
    transferRate.value = promedio.toFixed(2)  | 0;

    return promedio;
  } catch (err) {
    console.error('Error obteniendo tasa:', err);
    // Si falla, mantenemos el valor por defecto (15) o cualquier otro
    return null;
  }
}
document.addEventListener('DOMContentLoaded', async () => {
  //transferRate = document.getElementById('transferRate');

  // Inicializamos la tasa de Binance P2P
  const binanceRate = await fetchBinanceP2PAverage();
});
 */

/* const nav = document.getElementById('globalMenu');
const menuOptions = document.getElementById('menuOptions');
const menuToggle = document.getElementById('menuToggle');

const configSection = document.querySelector('.card-shadow'); // Primer panel: Configuraci√≥n

// L√≥gica de scroll: El nav se mantiene fijo solo hasta el top de la secci√≥n de configuraci√≥n.
window.addEventListener('scroll', () => {
  const configTop = configSection.getBoundingClientRect().top + window.scrollY;
  if (window.scrollY >= configTop - nav.offsetHeight) {
    nav.classList.remove('top-0');
    nav.classList.add('bottom-6', 'right-6', 'left-auto', 'rounded-full', 'p-0', 'w-14', 'h-14', 'justify-center', 'items-center');
    menuOptions.classList.add('hidden');
    menuToggle.classList.remove('hidden');
  } else {
    nav.classList.add('top-0');
    nav.classList.remove('bottom-6', 'right-6', 'left-auto', 'rounded-full', 'p-0', 'w-14', 'h-14', 'justify-center', 'items-center');
    menuOptions.classList.remove('hidden');
    menuToggle.classList.add('hidden');
  }
});

// L√≥gica para mostrar las opciones al hacer click en el bot√≥n
menuToggle.addEventListener('click', () => {
  menuOptions.classList.toggle('hidden');
}); */

const nav = document.getElementById('globalMenu');
const menuOptions = document.getElementById('menuOptions');
const menuToggle = document.getElementById('menuToggle');
const floatingMenu = document.getElementById('floatingMenu');
const configSection = document.querySelector('.card-shadow');
console.log(configSection)

window.addEventListener('scroll', () => {
//console.log(configSection)
  const configTop = configSection.getBoundingClientRect().top + window.scrollY;
  if (window.scrollY >= configTop - nav.offsetHeight) {
    nav.classList.remove('top-0');
    nav.classList.add('bottom-6', 'right-6', 'left-auto', 'rounded-full', 'p-0', 'w-14', 'h-14', 'justify-center', 'items-center');
    menuOptions.classList.add('hidden');
    menuToggle.classList.remove('hidden');
    floatingMenu.classList.add('hidden'); // Esconder men√∫ flotante inicialmente
  } else {
    nav.classList.add('top-0');
    nav.classList.remove('bottom-6', 'right-6', 'left-auto', 'rounded-full', 'p-0', 'w-14', 'h-14', 'justify-center', 'items-center');
    menuOptions.classList.remove('hidden');
    menuToggle.classList.add('hidden');
    floatingMenu.classList.add('hidden'); // Asegurar que el men√∫ flotante est√© oculto
  }
});

menuToggle.addEventListener('click', () => {
  floatingMenu.classList.toggle('hidden');
});


async function fetchBinanceP2PAverage() {
  try {
    const res = await fetch('/.netlify/functions/binance-p2p-average?asset=USDT&fiat=VES&tradeType=SELL&rows=20&trim=0.1');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    const data = await res.json();
    if (!data.ok) throw new Error(data.message || 'Respuesta no v√°lida');

    console.log('Binance P2P data:', data);

    // Tomamos los valores
    const promedio = /* data.stats.trimmedAverage ||  */data.stats.average;
    const maximo = data.stats.max;

    // Calculamos la diferencia
    const diferencia = Math.abs(maximo - promedio);

    // Si la diferencia es menor a 1.8 usamos el promedio, si no, el m√°ximo
    const valorFinal = /* diferencia < 1.8 ? promedio : maximo */promedio;

    // Asignamos el valor al input (sin el bitwise, que no es necesario aqu√≠)
    transferRate.value = valorFinal.toFixed(2);

    return maximo;

  } catch (err) {
    console.error('Error obteniendo tasa:', err);
    // Si falla, mantenemos el valor por defecto (15) o cualquier otro
    return null;
  }
}

// Listeners para inputs
productSelect.addEventListener('change', onProductChange);
customPrice.addEventListener('input', () => updatePrice('custom'));
customCurrency.addEventListener('change', () => updatePrice('currency'));
transferRate.addEventListener('input', calculateRealTime);
apiValueInput.addEventListener('input', calculateRealTime);
paymentMethod.addEventListener('change', onMethodChange);
transferAmount.addEventListener('input', calculateRealTime);



// Listener para el checkbox:
batteryFullCheckbox.addEventListener('change', () => {
  if (productSelect.value === 'custom') {
    updatePrice('custom');
  } else {
    onProductChange();
  }
});

function getAdjustedPrice(basePrice) {
  let price = basePrice;
  if (batteryFullCheckbox && batteryFullCheckbox.checked) {
    price += 20;
  }
  return price;
}
/* // Manejo de selecci√≥n de producto
function onProductChange() {
  const val = productSelect.value;
  if (val === 'custom') {
    customPriceDiv.classList.remove('hidden');
    currentPrice = 0;
    currentCurrency = customCurrency.value;
  } else if (!val) {
    customPriceDiv.classList.add('hidden');
    currentPrice = 0;
    currentCurrency = 'USD';
  } else {
    customPriceDiv.classList.add('hidden');
    const opt = productSelect.selectedOptions[0];
    currentPrice = parseFloat(opt.dataset.price) || 0;
    currentCurrency = opt.dataset.currency || 'USD';
  }
  calculateRealTime();
} */
// Modifica onProductChange:
function onProductChange() {
  const val = productSelect.value;
  if (val === 'custom') {
    customPriceDiv.classList.remove('hidden');
    currentPrice = getAdjustedPrice(parseFloat(customPrice.value) || 0);
    currentCurrency = customCurrency.value;
  } else if (!val) {
    customPriceDiv.classList.add('hidden');
    currentPrice = 0;
    currentCurrency = 'USD';
  } else {
    customPriceDiv.classList.add('hidden');
    const opt = productSelect.selectedOptions[0];
    const basePrice = parseFloat(opt.dataset.price) || 0;
    currentPrice = getAdjustedPrice(basePrice);
    currentCurrency = opt.dataset.currency || 'USD';
  }
  calculateRealTime();
}

/* // Actualiza el precio cuando cambias el input personalizado
function updatePrice(type) {
  if (type === 'custom') {
    currentPrice = parseFloat(customPrice.value) || 0;
  } else {
    currentCurrency = customCurrency.value;
  }
  calculateRealTime();
} */
// Modifica updatePrice:
function updatePrice(type) {
  if (type === 'custom') {
    currentPrice = getAdjustedPrice(parseFloat(customPrice.value) || 0);
  } else {
    currentCurrency = customCurrency.value;
    currentPrice = getAdjustedPrice(parseFloat(customPrice.value) || 0);
  }
  calculateRealTime();
}


// Mostrar u ocultar secci√≥n de pago mixto
function onMethodChange() {
  if (paymentMethod.value === 'mixed') {
    transferAmount.parentElement.classList.remove('hidden');
  } else {
    transferAmount.parentElement.classList.add('hidden');
  }
  calculateRealTime();
}

// Simula llamada a API para obtener divisor din√°mico

// üåê Obtener tasa USD ‚Üí VES real desde open.er-api.com
async function fetchExchangeRate() {
  try {
    const res = await fetch('https://open.er-api.com/v6/latest/USD');
    const data = await res.json();
    if (data.result === 'success' && data.rates.VES) {
      return parseFloat(data.rates.VES);
    } else {
      console.error('Error al obtener tasa:', data);
      return null;
    }
  } catch (err) {
    console.error('Fetch error:', err);
    return null;
  }
}


// Nuevo updateApiValue: consulta la API en vez de generar un valor random
// üîÅ Actualiza el campo de tasa usando fetchExchangeRate()
async function updateApiValue() {
  const rate = await fetchExchangeRate();
  const binanceRate = await fetchBinanceP2PAverage();
  if (rate !== null) {
    apiValueInput.value = rate.toFixed(2);
    transferRate.value = binanceRate.toFixed(2) | 0;
    calculateRealTime(); // recalcula con el nuevo valor
  }
}
updateApiValue();                      // al cargar
setInterval(updateApiValue, 30_000);   // cada 30 segundos




// Limpia el √°rea de resultados
function clearResults() {
  resultsDiv.innerHTML = `
    <div class="text-center text-gray-500 py-8">
      <div class="text-6xl mb-4">üßÆ</div>
      <p>Configura los par√°metros para ver los resultados en tiempo real</p>
    </div>`;
  comparisonDiv.classList.add('hidden');
}

// Reset visual
function resetVisualEffects() {
  resultsDiv.style.opacity   = '1';
  resultsDiv.style.transform = 'scale(1)';
  resultsDiv.style.transition= 'all 0.3s ease';
}

// C√°lculo en tiempo real con animaci√≥n
function calculateRealTime() {
  if (currentPrice <= 0) {
    clearResults();
    return;
  }

  resultsDiv.style.opacity   = '0.7';
  resultsDiv.style.transform = 'scale(0.98)';

  setTimeout(() => {
    const rate      = parseFloat(transferRate.value) || 0;
    const apiValue  = parseFloat(apiValueInput.value) || 1;
    const method    = paymentMethod.value;
    const tAmount   = parseFloat(transferAmount.value) || 0;
    let results     = {};

    switch (method) {
      case 'cash':
      case 'zelle':
      case 'binance':
        results = calculateDirectPayment();
        break;
      case 'transfer':
        results = calculateTransferPayment(rate, apiValue);
        break;
      case 'mixed':
        if (tAmount > 0 && tAmount < currentPrice) {
          results = calculateMixedPayment(tAmount, rate, apiValue);
        } else {
          clearResults();
          return;
        }
        break;
    }

    displayResults(results, method);
    showComparison(rate, apiValue);
    resetVisualEffects();
  }, 150);
}

// M√©todos de c√°lculo
function calculateDirectPayment() {
  return { originalPrice: currentPrice, finalPrice: currentPrice };
}

function calculateTransferPayment(rate, api) {
  const totalWithRate    = currentPrice * rate;
  const convertedAmount  = totalWithRate / api;
  return {
    originalPrice: currentPrice,
    finalPrice:    totalWithRate,
    convertedAmount,
    rate,
    apiValue: api
  };
}

function calculateMixedPayment(tAmount, rate, api) {
  const cashPart         = currentPrice - tAmount;
  const transferWithRate = tAmount * rate;
  const convertedTransf  = transferWithRate / api;
  return {
    originalPrice:   currentPrice,
    cashAmount:      cashPart,
    transferAmount:  tAmount,
    transferWithRate,
    convertedTransfer: convertedTransf,
    totalConverted:  cashPart + convertedTransf,
    rate,
    apiValue: api
  };
}

// Mostrar resultados en pantalla
function displayResults(res, method) {
  const sym = '$'
  let html = ''

  //‚Äì‚Äì‚Äì Directo: sin recargos
  if (['cash','zelle','binance'].includes(method)) {
    html = `
      <div class="bg-green-50 border border-green-200 rounded-lg p-4">
        <h3 class="font-semibold text-green-800 mb-2">‚úÖ Pago Directo</h3>
        <div class="text-2xl font-bold text-green-600">
          ${sym}${res.finalPrice.toFixed(2)}
        </div>
        <p class="text-green-700 text-sm mt-1">Sin recargos adicionales</p>
      </div>`
  }

  //‚Äì‚Äì‚Äì Transferencia completa
  else if (method === 'transfer') {
    html = `
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
        <h3 class="font-semibold text-blue-800 mb-3">üè¶ Transferencia Completa</h3>
        <div class="space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-600">Precio descuento en (USD):</span>
            <span class="font-semibold">${sym}${res.originalPrice.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">BNCUSDT95:</span>
            <span class="font-semibold">${res.rate}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">
              Costo base del equipo en Bs:
            </span>
            <span class="font-bold text-blue-600 text-lg">
              Bs ${res.finalPrice.toLocaleString()}
            </span>
          </div>
          <div class="flex justify-between border-t pt-2">
            <span class="text-gray-600">
              Equivalente BCV:
            </span>
            <span class="font-bold text-purple-600 text-lg">
              ${sym}${res.convertedAmount.toFixed(2)}
            </span>
          </div>
          <div class="flex justify-between bg-yellow-50 border border-yellow-200 rounded p-2 mt-2">
            <span class="text-yellow-700 font-medium">Diferencia vs precio base:</span>
            <span class="font-bold text-yellow-600">
              +${sym}${(res.convertedAmount - res.originalPrice).toFixed(3)}
            </span>
          </div>
        </div>
      </div>`
  }

  //‚Äì‚Äì‚Äì Pago mixto
  else if (method === 'mixed') {
    html = `
      <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4">
        <h3 class="font-semibold text-purple-800 mb-3">üîÑ Pago Mixto</h3>
        <div class="space-y-3">
          <div class="bg-white rounded p-3">
            <h4 class="font-medium text-gray-700 mb-2">
              üíµ Parte en Efectivo/Divisas/Zelle/Binance
            </h4>
            <div class="text-lg font-bold text-green-600">
              ${sym}${res.cashAmount.toFixed(2)}
            </div>
            
          </div>
          <div class="bg-white rounded p-3">
            <h4 class="font-medium text-gray-700 mb-2">üè¶ Parte en Transferencia</h4>
            <div class="text-sm text-gray-600 mb-1">
               ${res.transferAmount.toFixed(2)}RT√óTR${res.rate}
            </div>
            <div class="text-lg font-bold text-blue-600">
              Bs ${res.transferWithRate.toLocaleString()}
            </div>
            <div class="text-sm text-purple-600">
              Equivalente bcv(${res.apiValue}): 
              ${sym}${res.convertedTransfer.toFixed(2)}
            </div>
          </div>
          <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded p-3 border-t-2 border-purple-300">
            <div class="flex justify-between items-center">
              <span class="font-semibold text-gray-700">Total Final:</span>
              <span class="font-bold text-purple-700 text-xl">
                ${sym}${res.totalConverted.toFixed(3)}
              </span>
            </div>
            <div class="text-xs text-gray-600 mt-1">Efectivo + Transferencia convertida</div>
            <div class="flex justify-between bg-yellow-50 border border-yellow-200 rounded p-2 mt-2">
              <span class="text-yellow-700 font-medium text-sm">
                Diferencia vs precio base:
              </span>
              <span class="font-bold text-yellow-600 text-sm">
                +${sym}${(res.totalConverted - res.originalPrice).toFixed(3)}
              </span>
            </div>
          </div>
        </div>
      </div>`
  }

  resultsDiv.innerHTML = html
}

// Comparativa de m√©todos
function showComparison(rate, api) {
  const sym = currentCurrency === 'EUR' ? '‚Ç¨' : '$';
  const methods = [
    { name: 'Efectivo/Divisas', price: currentPrice, icon: 'üíµ' },
    { name: 'Zelle',           price: currentPrice, icon: 'üí≥' },
    { name: 'Binance',         price: currentPrice, icon: '‚Çø' },
    { name: 'Transferencia',   price: (currentPrice * rate) / api, icon: 'üè¶' }
  ];

  methods.sort((a, b) => a.price - b.price);

  comparisonContent.innerHTML = methods.map((m, i) => {
    const diff    = m.price - currentPrice;
    const isBest  = i === 0;
    return `
      <div class="flex justify-between items-center p-3 rounded-lg ${
        isBest ? 'bg-green-50 border border-green-200' : 'bg-gray-50'
      }">
        <div class="flex items-center gap-2">
          <span>${m.icon}</span>
          <span class="font-medium">${m.name}</span>
          ${isBest ? '<span class="text-xs bg-green-500 text-white px-2 py-1 rounded-full ml-2">MEJOR</span>' : ''}
        </div>
        <div class="text-right">
          <div class="font-bold ${
            isBest ? 'text-green-600' : 'text-gray-700'
          }">${sym}${m.price.toFixed(2)} ${currentCurrency}</div>
          ${diff > 0 ? `<div class="text-xs text-red-500">+${sym}${diff.toFixed(2)}</div>` : ''}
        </div>
      </div>`;
  }).join('');

  comparisonDiv.classList.remove('hidden');
}

// Nombre legible de cada m√©todo
function getMethodName(key) {
  const map = {
    cash:     'Efectivo/Divisas',
    zelle:    'Zelle',
    binance:  'Binance',
    transfer: 'Transferencia',
    mixed:    'Pago Mixto'
  };
  return map[key] || key;
}


/* //const productSelect = document.getElementById('productSelect');
const batteryFullCheckbox = document.getElementById('batteryFullCheckbox');

productSelect.addEventListener('change', updatePrice);
batteryFullCheckbox.addEventListener('change', updatePrice);

function updatePrice() {
  const selectedOption = productSelect.options[productSelect.selectedIndex];
  if (!selectedOption || !selectedOption.dataset.price) {
    console.log('No producto seleccionado');
    return;
  }

  let basePrice = parseFloat(selectedOption.dataset.price);
  if (batteryFullCheckbox.checked) {
    basePrice += 20; // Suma $20 si tiene 100% bater√≠a
  }

  console.log(`Precio ajustado: $${basePrice} USD`);
  // Aqu√≠ puedes actualizar la UI o precio mostrado seg√∫n tu app
}
 */



// Inicializaci√≥n
updateApiValue();
lastUpdateSpan.textContent = new Date().toLocaleTimeString('es-ES');
calculateRealTime();





























